var t=function(t,e,i,l){return new(i||(i=Promise))((function(s,n){function a(t){try{r(l.next(t))}catch(t){n(t)}}function o(t){try{r(l.throw(t))}catch(t){n(t)}}function r(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,o)}r((l=l.apply(t,e||[])).next())}))};class e{static getAll(){return t(this,void 0,void 0,(function*(){const t=yield fetch(this.BASE_URL);if(!t.ok)throw new Error(`Error al obtener las tareas: ${t.status} ${t.statusText}`);return yield t.json()}))}static create(e){return t(this,void 0,void 0,(function*(){const t=yield fetch(this.BASE_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw new Error(`Error al crear la tarea: ${t.status} ${t.statusText}`);return yield t.json()}))}static update(e){return t(this,void 0,void 0,(function*(){const t=yield fetch(`${this.BASE_URL}/${e.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw new Error(`Error al actualizar la tarea: ${t.status} ${t.statusText}`);return yield t.json()}))}static delete(e){return t(this,void 0,void 0,(function*(){const t=yield fetch(`${this.BASE_URL}/${e}`,{method:"DELETE"});if(!t.ok)throw new Error(`Error al eliminar la tarea: ${t.status} ${t.statusText}`)}))}}e.BASE_URL="http://localhost:8000/tasks";var i=function(t,e,i,l){return new(i||(i=Promise))((function(s,n){function a(t){try{r(l.next(t))}catch(t){n(t)}}function o(t){try{r(l.throw(t))}catch(t){n(t)}}function r(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,o)}r((l=l.apply(t,e||[])).next())}))};class l{constructor(){var t;this.init=()=>i(this,void 0,void 0,(function*(){null!==this.close&&this.close.addEventListener("click",(()=>{var t;null===(t=this.alert)||void 0===t||t.classList.remove("dismissible")})),null!==this.input&&(this.input.addEventListener("keydown",(t=>{"Enter"!=t.code&&"NumpadEnter"!=t.code||(t.preventDefault(),this.addTask(this.input,this.alert))})),this.input.addEventListener("input",(t=>{var e,i,l;""===(null===(e=this.input)||void 0===e?void 0:e.value)||(null===(i=this.alert)||void 0===i?void 0:i.classList.contains("dismissible"))||null===(l=this.alert)||void 0===l||l.classList.add("dismissible")}))),null!==this.arrow&&this.arrow.addEventListener("click",(t=>{t.preventDefault(),this.addTask(this.input,this.alert)})),null!==this.buttons&&this.buttons.forEach(((t,e,i)=>{t.addEventListener("click",(()=>{i.forEach((t=>{t.classList.contains("active")&&t.classList.remove("active")})),t.classList.add("active"),this.filterTasks(t.textContent)}))})),this.allTasks=yield e.getAll(),this.renderTasks(this.allTasks)})),this.filterTasks=t=>i(this,void 0,void 0,(function*(){var e,i;switch(t){case"All":null!==this.allTasks&&null!==this.table&&(this.table.innerHTML="",this.renderTasks(this.allTasks));break;case"Completed":if(null!==this.allTasks&&null!==this.table){let t=null===(e=this.allTasks)||void 0===e?void 0:e.filter((t=>t.isDone));this.table.innerHTML="",this.renderTasks(t)}break;case"Uncompleted":if(null!==this.allTasks&&null!==this.table){let t=null===(i=this.allTasks)||void 0===i?void 0:i.filter((t=>!t.isDone));this.table.innerHTML="",this.renderTasks(t)}break;default:throw new Error("Filter not found")}})),this.generateRow=(t,e,i)=>{var l,s,n,a,o,r,d,u,c,h,v,f,m;let p=document.createElement("tr");return p.setAttribute("id",t),e=i?`<del>${e}</del>`:e,p.innerHTML=`\n<td>\n  <i class="fa-solid fa-circle-check"></i>\n  <span contenteditable="true" class="task">${e}</span>\n</td>\n<td>\n  <span class="fa-stack fa-2x">\n    <i class="fa-solid fa-square fa-stack-2x"></i>\n    <i class="fa-solid fa-stack-1x fa-pencil fa-inverse"></i>\n  </span>\n</td>\n<td>\n  <span class="fa-stack fa-2x">\n    <i class="fa-solid fa-square fa-stack-2x"></i>\n    <i class="fa-solid fa-stack-1x fa-trash fa-inverse"></i>\n  </span>\n</td>\n  `,null===(s=null===(l=p.firstElementChild)||void 0===l?void 0:l.firstElementChild)||void 0===s||s.addEventListener("click",(t=>this.crossOut(t))),null===(a=null===(n=p.firstElementChild)||void 0===n?void 0:n.lastElementChild)||void 0===a||a.addEventListener("focus",(t=>{let e=t;this.editModeOn(e,!0)})),null===(r=null===(o=p.firstElementChild)||void 0===o?void 0:o.lastElementChild)||void 0===r||r.addEventListener("blur",(t=>{let e=t;this.editModeOff(e)})),null===(h=null===(c=null===(u=null===(d=p.firstElementChild)||void 0===d?void 0:d.nextElementSibling)||void 0===u?void 0:u.firstElementChild)||void 0===c?void 0:c.lastElementChild)||void 0===h||h.addEventListener("click",(t=>{let e=t;this.editModeOn(e,!1)})),null===(m=null===(f=null===(v=p.lastElementChild)||void 0===v?void 0:v.firstElementChild)||void 0===f?void 0:f.lastElementChild)||void 0===m||m.addEventListener("click",(t=>{let e=t;this.removeRow(e,!1)})),p},this.renderTasks=t=>{null!==this.table&&t.forEach((t=>{var e;null===(e=this.table)||void 0===e||e.appendChild(this.generateRow(t.id,t.title,t.isDone))}))},this.crossOut=t=>{var i,l,s;let n=null===(i=t.target)||void 0===i?void 0:i.nextElementSibling;null==n||n.innerHTML;const a=null===(l=null==n?void 0:n.parentNode)||void 0===l?void 0:l.parentNode;if(a instanceof HTMLElement){let t=a.getAttribute("id"),i=null===(s=this.allTasks)||void 0===s?void 0:s.find((e=>e.id===t));if(console.log(i),null!==t){let l={id:t,isDone:!(null==i?void 0:i.isDone)};e.update(l)}}},this.addTask=(t,l)=>i(this,void 0,void 0,(function*(){let i;if(""===(null==t?void 0:t.value.trim()))t.value="",null==l||l.classList.remove("dismissible");else if(null!==t){i=null==t?void 0:t.value;let s={id:this.idGenerator(),title:i,isDone:!1};try{if(!(yield e.create(s)))throw new Error("No se ha podido aÃ±adir la tarea");this.allTasks=yield e.getAll(),this.renderTasks(this.allTasks)}catch(t){l&&(l.textContent=t.message,l.classList.remove("dismissible"))}}})),this.editModeOn=(t,e)=>{var i,l,s,n,a;let o;e?o=t.currentTarget:(o=null===(n=null===(s=null===(l=null===(i=t.currentTarget)||void 0===i?void 0:i.parentNode)||void 0===l?void 0:l.parentNode)||void 0===s?void 0:s.previousElementSibling)||void 0===n?void 0:n.lastElementChild,o.focus()),o.innerHTML.includes("<del>")?this.text=null===(a=null==o?void 0:o.firstElementChild)||void 0===a?void 0:a.textContent:this.text=null==o?void 0:o.textContent,o.classList.add("editable"),document.addEventListener("keydown",(t=>{"Enter"!=t.code&&"NumpadEnter"!=t.code&&"Escape"!=t.code||o.blur()}))},this.editModeOff=t=>i(this,void 0,void 0,(function*(){var i,l;let s=t.currentTarget;if(""===s.innerHTML)this.removeRow(t,!0);else{s.classList.remove("editable");let n=this.clearWhitespaces(s.innerHTML);const a=/<\/?del>/g,o=n.replace(a,"");if(""===n)this.removeRow(t,!0);else if(o!==this.text){let t=null===(l=null===(i=s.parentNode)||void 0===i?void 0:i.parentNode)||void 0===l?void 0:l.getAttribute("id");if(null!==t){let i={id:t,title:n};try{if(!(yield e.update(i)))throw new Error("No se ha podido actualizar la tarea");this.allTasks=yield e.getAll(),this.renderTasks(this.allTasks)}catch(t){this.alert&&(this.alert.textContent=t.message,this.alert.classList.remove("dismissible"))}}}}})),this.removeRow=(t,l)=>i(this,void 0,void 0,(function*(){var i,s,n,a,o,r,d;let u;u=l?null===(n=null===(s=null===(i=t.target)||void 0===i?void 0:i.parentNode)||void 0===s?void 0:s.parentNode)||void 0===n?void 0:n.getAttribute("id"):null===(d=null===(r=null===(o=null===(a=t.target)||void 0===a?void 0:a.parentNode)||void 0===o?void 0:o.parentNode)||void 0===r?void 0:r.parentNode)||void 0===d?void 0:d.getAttribute("id");try{if(null===u)throw new Error("No se ha podido eliminar la tarea, id no encontrado");yield e.delete(u),this.allTasks=yield e.getAll(),this.renderTasks(this.allTasks)}catch(t){this.alert&&(this.alert.textContent=t.message,this.alert.classList.remove("dismissible"))}})),this.clearWhitespaces=t=>t.replace(new RegExp(/&nbsp;/,"g"),"").trim(),this.idGenerator=()=>Math.floor(16777215*Math.random()).toString(16),this.alert=document.querySelector(".alert"),this.close=null===(t=this.alert)||void 0===t?void 0:t.firstElementChild,this.input=document.querySelector("input"),this.arrow=document.querySelector(".arrow"),this.table=document.querySelector("tbody"),this.text=null,this.allTasks=null,this.buttons=document.querySelectorAll(".main .header button")}}window.addEventListener("load",(()=>{return t=void 0,e=void 0,s=function*(){(new l).init()},new((i=void 0)||(i=Promise))((function(l,n){function a(t){try{r(s.next(t))}catch(t){n(t)}}function o(t){try{r(s.throw(t))}catch(t){n(t)}}function r(t){var e;t.done?l(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(a,o)}r((s=s.apply(t,e||[])).next())}));var t,e,i,s}));